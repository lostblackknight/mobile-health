# 小蜜蜂医疗

## 简介

小蜜蜂医疗是一款移动医疗 APP ，前台 APP 使用 Vue + Vant 组件库开发，后台管理系统使用 Vue + Element UI 组件库开发，后台采用Spring Boot + Spring Cloud 的微服务的架构模式进行开发，采用的 **Jdk 版本为 11** 整个项目的部署采用 Docker 进行部署。

实现了在线预约挂号、在线支付(支付宝支付)、在线咨询、医院导航、健康指导等功能。

- [前台 APP 的地址](https://github.com/lostblackknight/mobile-health-app)
- [后台管理系统的地址](https://github.com/lostblackknight/mobile-health-admin)
- [后台地址](https://github.com/lostblackknight/mobile-health)

## 项目展示

### 前台 APP

<img src="https://s2.loli.net/2022/06/29/zRQCZ7mPuI2xF6k.png" alt="image-20220628212748302" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/HgMefRaQ1FDv92b.png" alt="image-20220628212813526" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/AZlBVKHwun2dTNj.png" alt="image-20220628212820309" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/JGBAEfhsCtiLNem.png" alt="image-20220628212941415" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/VOGonKCgPaX5tvq.png" alt="image-20220628213015132" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/CysQF4DoxRkEMJP.png" alt="image-20220628213024847" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/Oq2yBtMZkr3dxJ1.png" alt="image-20220628213030454" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/D9F8o1iZjKNQEvL.png" alt="image-20220628213035802" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/hROpCVKP7oIl2XS.png" alt="image-20220628213041796" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/fjxbetO1EDnSdBA.png" alt="image-20220629094729729" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/HMpjYCnO1KGJWBm.png" alt="image-20220629094747623" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/qbDypjYflNcOQ64.png" alt="image-20220629094800273" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/8OtJmsCh7pYAHlj.png" alt="image-20220629094813510" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/6seLTnl7mzBiUCf.png" alt="image-20220629094836711" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/P6S2pHZfOuDgb8r.png" alt="image-20220629094854766" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/ITSQvZRPmLdoEhx.png" alt="image-20220629094908865" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/AlUgQsdHJPrYb96.png" alt="image-20220629094930210" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/CSDUdnwjz82lNPb.png" alt="image-20220629094942520" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/lWxdzmrjysbkFKV.png" alt="image-20220629094954660" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/z2rgyHXZ15dCmeO.png" alt="image-20220629095017386" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/q6IOtl9FnZc27AN.png" alt="image-20220629095028119" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/v96FqY1rNtwgOJ7.png" alt="image-20220629095045953" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/v2htESTBzAQpOId.png" alt="image-20220629095059368" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/s6FeOQx8ykVRpfN.png" alt="image-20220629095110463" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/So84QHE35DdIl1A.png" alt="image-20220629095123290" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/doV1QKqhsyNCzkw.png" alt="image-20220629095134236" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/c2yWZ83iQKv7E6f.png" alt="image-20220629095143309" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/pCKsJkX3S1f6EgH.png" alt="image-20220629095230605" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/mglLwMPd1I2y67C.png" alt="image-20220629095239771" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/KQxYIlGnASMN54k.png" alt="image-20220629095248693" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/14qtCET6lphu9oS.png" alt="image-20220629095259576" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/f135oG8Zn2SXkWi.png" alt="image-20220629095309956" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/WlcP6jfDCVHY2rg.png" alt="image-20220629095319190" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/c41ZdytnXEAUPHi.png" alt="image-20220629095330518" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/CcPTJAdBxiqStOU.png" alt="image-20220629095339482" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/gvBuxs8KtJjnLdI.png" alt="image-20220629095350097" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/Sn7rXQI9GgUfwCL.png" alt="image-20220629095404857" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/TakOpmBhEuYJSC1.png" alt="image-20220629095414849" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/s4pIUGmxOB5jXW8.png" alt="image-20220629095428731" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/LD2J9N8eBpTwPZI.png" alt="image-20220629095440107" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/z2rgyHXZ15dCmeO.png" alt="image-20220629095459472" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/dGaZQibSxcpmA5r.png" alt="image-20220629095508575" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/rYRB5I2yK6ixAsm.png" alt="image-20220629095520151" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/ehfcHZRtXQSvjzY.png" alt="image-20220629095536037" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/lzbkBZFo1WPcsS8.png" alt="image-20220629095548137" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/NjYfn6bLPcR5Msi.png" alt="image-20220629095611334" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/tOmYkliD9uSojMP.png" alt="image-20220629095622914" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/FPEBRlHDpAdixbv.png" alt="image-20220629095634621" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/I8skavtguhPREDy.png" alt="image-20220629095645861" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/JgekcvILYQVaF3p.png" alt="image-20220629095705070" style="zoom:50%;" />

### 后台管理系统

<img src="https://s2.loli.net/2022/06/29/AI4BFQ9fHwevh72.png" alt="image-20220629095754531" style="zoom: 50%;" /><img src="https://s2.loli.net/2022/06/29/DTdMWHtJVCuwiAI.png" alt="image-20220629095812047" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/7ArbkLgWofj8qme.png" alt="image-20220629095830514" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/KgDdsGzEBCuOco9.png" alt="image-20220629095842025" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/n6pJ2iCV1DozhS4.png" alt="image-20220629095854190" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/bv7HNtVZznPXWQC.png" alt="image-20220629095905920" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/5ouGntM8yI9TW7D.png" alt="image-20220629095921357" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/lj4WAz9fbgTU68s.png" alt="image-20220629095931627" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/D7hl1FBztNOkT3S.png" alt="image-20220629095943000" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/OraDNYxpzsmTtjf.png" alt="image-20220629095954280" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/RP21GF56fh8rstA.png" alt="image-20220629100026347" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/BvXwdLb8REtf45H.png" alt="image-20220629100037484" style="zoom:50%;" /><img src="https://s2.loli.net/2022/06/29/fQFl3L5TVc6e7mR.png" alt="image-20220629100051017" style="zoom:50%;" />

## 整体架构图

![image-20220628131011563](https://s2.loli.net/2022/06/28/UOhBw7a3I2yZCJY.png)

## 功能模块图

![功能模块](https://s2.loli.net/2022/06/28/5nMSLwgJHy9z2UT.png)

## 目录结构

```shell
bee-health   
├── bee-health-common                     # 公共部分
│       └── constant                      # 常量
│       └── model                         # 数据模型
│       └── properties                    # 属性
│       └── util                          # 工具类
├── bee-health-admin                      # 后台服务
├── bee-health-gateway                    # 网关服务
├── bee-health-hospital                   # 医院服务
├── bee-health-member                     # 会员服务
├── bee-health-message                    # 消息服务
├── bee-health-mock                       # 医院客户端模拟
├── bee-health-order                      # 订单服务
├── bee-health-search                     # 检索服务
├── bee-health-third-party                # 第三方服务
├── bee-health-topic                      # 主题服务
```

## Docker 部署

### 环境要求

1. 虚拟机或服务器的内存务必保证有 6 G 及以上，磁盘保证有 40 G 及以上。
2. docker、docker-compose、git 环境。

### 后台部署

1. 安装项目。

   ```bash
   git clone https://github.com/lostblackknight/mobile-health.git
   ```

2. 部署组件。

   > 提示：如果 Nacos 服务无法访问，可以使用 `docker restart <container_id>` 命令重启服务

   ```bash
   cd mobile-health
   ```

   ```shell
   docker-compose -f docker-compose-e.yml up -d
   ```

3. 部署服务。

   > 注意：务必保证部署的组件全部启动成功后再部署

   ```bash
   docker-compose -f docker-compose-app.yml up -d
   ```

### 后台管理系统部署

1. 安装项目。

   ```bash
   git clone https://github.com/lostblackknight/mobile-health-admin.git
   ```

2. 修改后台 API 的地址。

   ```bash
   cd mobile-health-admin
   ```

   >  修改 `BASE_API_HOST` 环境变量

   ```bash
   vim docker-compose.yml
   ```

3. 部署项目。

   ```bash
   docker-compose up -d
   ```

### 前台APP部署

1. 安装项目。

   ```bash
   git clone https://github.com/lostblackknight/mobile-health-app.git
   ```

2. 修改后台 API 的地址。

   ```bash
   cd mobile-health-app
   ```

   > 修改 `BASE_API_HOST` 环境变量

   ```bash
   vim docker-compose.yml
   ```

3. 部署项目。

   ```bash
   docker-compose up -d
   ```

## 上传测试数据

### 上传医院数据到ES

1. 打开 `bee-health-mock` 项目中的 `BeeHealthTemplate` 类，修改`HOSPITAL_API` `TOKEN_API`中的 host 和 port 为网关的 host 和 port。

   ![image-20220628181931980](https://s2.loli.net/2022/06/28/CqF6MiU2cvTwzOf.png)

2. 启动项目 `bee-health-mock` ，发送 GET 请求。(推荐使用 Postman 发送)

   ```tex
   http://localhost:7011/hospitals/upload?clientId=1a903469ecdb481ea05651be04312ad0&secret=d6b382c1-2524-49d5-b1dc-2c01790bbbd8&hospitalName=北京天使儿童医院
   ```
   
   ```
   http://localhost:7011/hospitals/upload?clientId=cd50350b4fa84d2b87d5cb6f4342b7b2&secret=a07ada8f-4f82-4af1-aafc-7d7948198a9e&hospitalName=太原肤康中医皮肤病医院
   ```

### 上传科室数据到ES

1. 启动项目 `bee-health-mock` ，发送 GET 请求。

   ```tex
   http://localhost:7011/depts/upload?clientId=1a903469ecdb481ea05651be04312ad0&secret=d6b382c1-2524-49d5-b1dc-2c01790bbbd8&hospitalName=北京天使儿童医院
   ```
   
   ```
   http://localhost:7011/depts/upload?clientId=cd50350b4fa84d2b87d5cb6f4342b7b2&secret=a07ada8f-4f82-4af1-aafc-7d7948198a9e&hospitalName=太原肤康中医皮肤病医院
   ```

### 上传排班数据到ES

1. 启动项目 `bee-health-mock` ，发送 GET 请求。

   ```tex
   http://localhost:7011/schedules/upload?clientId=1a903469ecdb481ea05651be04312ad0&secret=d6b382c1-2524-49d5-b1dc-2c01790bbbd8&hospitalName=北京天使儿童医院
   ```
   
   ```
   http://localhost:7011/schedules/upload?clientId=cd50350b4fa84d2b87d5cb6f4342b7b2&secret=a07ada8f-4f82-4af1-aafc-7d7948198a9e&hospitalName=太原肤康中医皮肤病医院
   ```

### 上传文章数据到ES

1. 文章数据已经存在在数据库中，一共有十条数据。进入后台管理系统文章列表功能页面，点击修改按钮，再点击确定，将文章上传到 ES 中。

## 短信服务接入

1. 在阿里云平台申请相关的服务。

2. 在 nacos 中的  `bee-health-third-party-prod.yaml` 中进行配置。

3. 默认使用测试短信，可以在  `bee-health-third-party` 模块中的`SmsCodeTemplate`中修改，然后编译打包放到 `docker/app/third-party` 中重新部署。

   ```yaml
   aliyun:
     sms:
       access-key-id: xxx
       access-key-secret: xxx
       endpoint: xxx
   ```

## OSS 服务接入

1. 在阿里云平台申请相关服务。

2. 在 nacos 中的  `bee-health-third-party-prod.yaml` 中进行配置。

   ```yaml
   aliyun:
     oss:
       endpoint: xxx
       access-key-id: xxx
       access-key-secret: xxx
       bucket-name: xxx
   ```

## 支付服务接入

1. 在支付宝开放平台创建相关的应用。

2. 在 nacos 中的  `bee-health-order-prod.yaml` 中进行配置。

   ```yaml
   alipay:
     app-id: xxx
     gateway-url: xxx
     alipay-public-key: xxx
     app-private-key: xxx
     notify-url: http://39.106.85.222:7001/api/order/payment/notify
     return-url: http://localhost:9527/payment
   ```

3. `notify-url`需要公网可以访问，可以使用内网穿透技术实现。

   - 有服务器，可以使用frp。
   - 没有服务器，可以使用花生壳。
   
## 保持联系

- 你可以在[Github](https://github.com/lostblackknight/mobile-health)上，反馈漏洞，提出建议，查看源码。
- 其他问题，请使用E-mail : chensixiang1234@gmail.com。